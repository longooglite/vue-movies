#!/bin/sh

# Run unit tests before committing. Abort commit on failure.

# Try to use Node 22 via nvm if available (non-fatal if not present)
if [ -z "$NVM_DIR" ]; then
  NVM_DIR="$HOME/.nvm"
fi
if [ -s "$NVM_DIR/nvm.sh" ]; then
  . "$NVM_DIR/nvm.sh"
  nvm use 22 >/dev/null 2>&1 || true
fi

printf "Running unit tests...\n"
yarn test --silent
result=$?

if [ $result -ne 0 ]; then
  printf "\nUnit tests failed. Aborting commit.\n"
  exit $result
fi

printf "Unit tests passed.\n"
exit 0


